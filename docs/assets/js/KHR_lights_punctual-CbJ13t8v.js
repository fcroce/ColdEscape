import{aF as p,b as o,aG as L,aH as u,aI as A,C as c,a6 as m,a7 as f}from"./index-DsZJ-ns8.js";import{A as _,G as g}from"./glTFLoader-co7haj5e.js";import"./glTFLoaderAnimation-poukCSLX.js";const s="KHR_lights_punctual";class E{constructor(n){this.name=s,this._loader=n,this.enabled=this._loader.isExtensionUsed(s)}dispose(){this._loader=null,delete this._lights}onLoading(){const n=this._loader.gltf.extensions;if(n&&n[this.name]){const a=n[this.name];this._lights=a.lights,_.Assign(this._lights)}}loadNodeAsync(n,a,b){return g.LoadExtensionAsync(n,a,this.name,(l,y)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(n,a,r=>{let t;const e=_.Get(l,this._lights,y.light),h=e.name||r.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,e.type){case"directional":{const i=new u(h,o.Backward(),this._loader.babylonScene);i.position.setAll(0),t=i;break}case"point":{t=new L(h,o.Zero(),this._loader.babylonScene);break}case"spot":{const i=new p(h,o.Zero(),o.Backward(),0,1,this._loader.babylonScene);i.angle=(e.spot&&e.spot.outerConeAngle||Math.PI/4)*2,i.innerAngle=(e.spot&&e.spot.innerConeAngle||0)*2,t=i;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${l}: Invalid light type (${e.type})`)}t._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,e._babylonLight=t,t.falloffType=A.FALLOFF_GLTF,t.diffuse=e.color?c.FromArray(e.color):c.White(),t.intensity=e.intensity==null?1:e.intensity,t.range=e.range==null?Number.MAX_VALUE:e.range,t.parent=r,this._loader._babylonLights.push(t),g.AddPointerMetadata(t,l),b(r)})))}}m(s);f(s,!0,d=>new E(d));export{E as KHR_lights};
